import{cromaSos,cromaBem,notasACifrado}from"./config.js";import{analizarAcorde}from"./logic.js";import{mostrarResultado,mostrarError,actualizarBoton}from"./ui.js";export function obtenerNotasSeleccionadas(){return{tonica:document.getElementById("notaUno").value,mediante:document.getElementById("notaDos").value,dominante:document.getElementById("notaTres").value}}export function obtenerNotasComoArray(){const e=document.getElementById("usarSeptima").checked,o=document.getElementById("notaUno").value,t=document.getElementById("notaDos").value,n=document.getElementById("notaTres").value,a=e?document.getElementById("notaCuatro").value:null,r=[o,t,n];e&&a&&r.push(a);const c=r.some(e=>!e),d=new Set(r).size<r.length;return c||d?[]:r}export function verificarNotasValidas(){const e=document.getElementById("usarSeptima").checked,{tonica:o,mediante:t,dominante:n}=obtenerNotasSeleccionadas(),a=e?document.getElementById("notaCuatro").value:null,r=[o,t,n];e&&r.push(a);const c=r.some(e=>!e),d=new Set(r).size<r.length,s=c||d;actualizarBoton(s),mostrarError(c?"Debes seleccionar tres notas distintas para detectar el acorde.":d?"Las notas seleccionadas deben ser distintas.":"");document.getElementById("reproducirNotas").disabled=s}export function actualizarOpciones(){const e=document.getElementById("usarBemoles").checked?cromaBem:cromaSos,o=document.getElementById("usarSeptima").checked,t=["notaUno","notaDos","notaTres"];o&&t.push("notaCuatro"),document.getElementById("campoSeptima").style.display=o?"block":"none";const n=Object.values(obtenerNotasSeleccionadas());t.forEach(o=>{const t=document.getElementById(o),a=t.value;t.innerHTML="",e.forEach(e=>{if(!n.includes(e)||e===a){const o=document.createElement("option");o.value=e,o.textContent=e,e===a&&(o.selected=!0),t.appendChild(o),a||t.value||0!==optionIndex||(t.value=e)}})}),verificarNotasValidas()}export function detectarAcorde(){const{tonica:e,mediante:o,dominante:t}=obtenerNotasSeleccionadas(),n=document.getElementById("usarBemoles").checked,a=document.getElementById("usarSeptima").checked?document.getElementById("notaCuatro").value:null,r=analizarAcorde(e,o,t,n,a);if(!r)return mostrarError("La combinaci贸n ingresada no forma un acorde en su inversi贸n fundamental."),void mostrarResultado("Acorde no reconocido","Acorde no reconocido");const{tipoLatina:c,tipoAmericana:d,tonicaAmericana:s}=r;if("desconocido"===c||"?"===d)return mostrarError("La combinaci贸n ingresada no forma un acorde en su inversi贸n fundamental."),void mostrarResultado("Acorde no reconocido","Acorde no reconocido");const i=`${e} ${c}`,m=`${s}${d}`;mostrarError(""),mostrarResultado(i,m)}