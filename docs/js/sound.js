import{calcularFrecuenciaNota,cromaSos,cromaBem}from"./config.js";function ajustarRango(e,o=80,t=2e3){for(;e<o;)e*=2;for(;e>t;)e/=2;return e}const formasPorDefecto=["square","sawtooth","sine","triangle"];function obtenerOctavaBase(e){const o=!["reâ™­","miâ™­","solâ™­","laâ™­","siâ™­"].includes(e);let t=o?cromaSos:cromaBem,a=t.indexOf(e);if(-1===a){const n=o?cromaBem:cromaSos;if(a=n.indexOf(e),-1===a)return 4;t=n}return a>=t.indexOf("mi")?3:4}export function reproducirArpegioMixto(e,o=formasPorDefecto){const t=new(window.AudioContext||window.webkitAudioContext),a=obtenerOctavaBase(e[0]);let n=null;e.forEach((e,c)=>{let r=a;if(null!==n)for(;calcularFrecuenciaNota(e,r)<n&&r<7;)r++;const i=calcularFrecuenciaNota(e,r);if(!i)return;n=i;const l=t.currentTime+.6*c;reproducirNotaCompleja(t,i,l,1.5,o)});const c=t.currentTime+.6*e.length+.3;let r=null;e.forEach(e=>{let n=a;if(null!==r)for(;calcularFrecuenciaNota(e,n)<=r&&n<7;)n++;const i=calcularFrecuenciaNota(e,n);if(!i)return;r=i;const l=ajustarRango(i);reproducirNotaCompleja(t,l,c,3.5,o),console.log(`  ðŸŽ¶ ${e}${n} â†’ ${l.toFixed(2)} Hz`)})}function reproducirNotaCompleja(e,o,t,a,n){const c=e.createGain();n.forEach(r=>{const i=e.createOscillator(),l=e.createGain();i.type=r,i.frequency.value=o,l.gain.setValueAtTime(.2/n.length,t),i.connect(l),l.connect(c),i.start(t),i.stop(t+a)});const r=e.createBiquadFilter();r.type="lowpass",r.frequency.value=1e3;const i=e.createGain();i.gain.setValueAtTime(.001,t),i.gain.linearRampToValueAtTime(.6,t+.1),i.gain.exponentialRampToValueAtTime(.001,t+a),c.connect(r),r.connect(i),i.connect(e.destination)}